# rsyslog.conf snippet for Sentinel logs
# Place this file in /etc/rsyslog.d/ or include it in your main rsyslog.conf

# Ensure that rsyslog is configured to receive messages from systemd-journald
# This is usually enabled by default, but verify:
# $ModLoad imjournal

# Define a template for structured JSON logs from Sentinel
# Sentinel logs are expected to be JSON on stdout/stderr
template(name="SentinelJsonFormat" type="list") {
    property(name="jsonmsg")
}

# Rule to capture Sentinel logs
# Assuming Sentinel logs are tagged with 'sentinel' or come from its systemd unit
# Adjust the filter condition as needed based on how Sentinel logs are identified in your journal/syslog
:programname, isequal, "sentinel" { # Or use :systemd.unit, isequal, "sentinel.service"
    # Write to a local file for immediate inspection
    action(type="omfile" file="/var/log/sentinel/sentinel.log" template="SentinelJsonFormat")

    # Forward to VictoriaLogs via TCP (replace with your VictoriaLogs IP/hostname and port)
    # Ensure VictoriaLogs is configured to listen on this port (e.g., 514 or 1514 for syslog)
    # action(type="omfwd" target="your_victorialogs_ip" port="1514" protocol="tcp" template="SentinelJsonFormat")

    # Stop processing further rules for Sentinel messages
    stop
}

# Create the log directory if it doesn't exist
# This should ideally be handled by the deployment script or systemd unit setup
# $mkdir /var/log/sentinel
